webpackJsonp([8],{"/rEA":function(e,t,i){"use strict";(function(e){function n(e,t,i){this.name="ApiError",this.message=e||"Default Message",this.errorType=t||h.Default,this.innerError=i,this.stack=(new Error).stack}var o=i("//Fk"),r=i.n(o),a=i("mvHQ"),s=i.n(a),l=i("OvRC"),u=i.n(l),d=i("mtWM"),c=i.n(d),m=i("mw3O"),f=i.n(m),p=i("bzuE"),h={Default:"default",Sysetem:"sysetem"};(n.prototype=u()(Error.prototype)).constructor=n;var g=c.a.create({baseURL:p.a,timeout:2e4,responseType:"json",withCredentials:!0});g.interceptors.request.use(function(e){return"post"===e.method||"put"===e.method||"patch"===e.method?(e.headers={"Content-Type":"application/json charset=utf-8"},e.data=s()(e.data)):"delete"!==e.method&&"get"!==e.method&&"head"!==e.method||(e.paramsSerializer=function(e){return f.a.stringify(e,{arrayFormat:"indices"})}),e},function(e){return e}),g.interceptors.response.use(function(t){if(-1===t.headers["content-type"].indexOf("json"))return t;var i=void 0;if("arraybuffer"===t.request.responseType&&"[object ArrayBuffer]"===t.data.toString()){var o=e.from(t.data).toString("utf8");console.log(o),i=JSON.parse(o)}else i=t.data;if(i&&i.url)top.location=i.url;else if(i&&200!==i.code)return console.log(i),r.a.reject(new n(i.message));return t},function(e){return r.a.reject(new n(e.message,h.Sysetem,e))}),t.a={install:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.httpClient=g,e.prototype.$httpClient=g}}}).call(t,i("EuP9").Buffer)},TYWf:function(e,t){},UKyY:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("tvR6"),o=(i.n(n),i("qBF2")),r=i.n(o),a=i("7+uW"),s=i("uN2V"),l=(i.n(s),i("gRoo")),u=i("/rEA");a.default.config.productionTip=!1,a.default.use(r.a),a.default.use(u.a),new a.default({el:"#app",render:function(e){return e(l.a)}})},VsUZ:function(e,t,i){"use strict";var n=i("7+uW");t.a={login:function(e){return n.default.httpClient.post("/admin/login",e)},logout:function(){return n.default.httpClient.post("/admin/logout")},getProfile:function(){return n.default.httpClient.get("/admin/getProfile")},changeProfile:function(e){return n.default.httpClient.post("/admin/changeProfile",e)},changePassword:function(e){return n.default.httpClient.post("/admin/changePassword",e)},getMenus:function(){return n.default.httpClient.get("/admin/getMenus")},getServerInfo:function(){return n.default.httpClient.get("/admin/getServerinfo")},getSiteConfig:function(){return n.default.httpClient.get("/admin/getSiteconfig")},editSiteConfig:function(e){return n.default.httpClient.post("/admin/editSiteconfig",e)},getBulletin:function(){return n.default.httpClient.get("/admin/getBulletin")},editBulletin:function(e){return n.default.httpClient.post("/admin/editBulletin",e)},getPermissions:function(){return n.default.httpClient.get("/admin/getPermissions")},getModuleConfig:function(){return n.default.httpClient.get("/admin/getModuleConfig")},extractModulePermissions:function(){return n.default.httpClient.get("/admin/extractModulePermissions")},clearModulePermissions:function(){return n.default.httpClient.get("/admin/clearModulePermissions")},getRoles:function(){return n.default.httpClient.get("/admin/getRoles")},addRole:function(e){return n.default.httpClient.post("/admin/addRole",e)},editRole:function(e){return n.default.httpClient.post("/admin/editRole",e)},removeRole:function(e){return n.default.httpClient.post("/admin/removeRole",e)},moveRole:function(e){return n.default.httpClient.post("/admin/moveRole",e)},saveRoleName:function(e){return n.default.httpClient.post("/admin/saveRoleName",e)},getGroupTree:function(){return n.default.httpClient.get("/admin/getGroupTree")},addGroup:function(e){return n.default.httpClient.post("/admin/addGroup",e)},editGroup:function(e){return n.default.httpClient.post("/admin/editGroup",e)},removeGroup:function(e){return n.default.httpClient.post("/admin/removeGroup",e)},moveGroup:function(e){return n.default.httpClient.post("/admin/moveGroup",e)},getUsers:function(e){return n.default.httpClient.post("/admin/getUsers",e)},addUser:function(e){return n.default.httpClient.post("/admin/addUser",e)},editUser:function(e){return n.default.httpClient.post("/admin/editUser",e)},removeUser:function(e){return n.default.httpClient.post("/admin/removeUser",e)},getUserStatus:function(){return n.default.httpClient.get("/admin/getUserStatus")},getNotificationsForManager:function(e){return n.default.httpClient.post("/admin/getNotificationsForManager",e)},addNotification:function(e){return n.default.httpClient.post("/admin/addNotification",e)},editNotification:function(e){return n.default.httpClient.post("/admin/editNotification",e)},removeNotification:function(e){return n.default.httpClient.post("/admin/removeNotification",e)},getNotifications:function(e){return n.default.httpClient.post("/admin/getNotifications",e)},readNotifications:function(e){return n.default.httpClient.post("/admin/readNotifications",e)},deleteNotifications:function(e){return n.default.httpClient.post("/admin/deleteNotifications",e)},getNewestNotification:function(e){return n.default.httpClient.post("/admin/getNewestNotification",e)},getGroups:function(){return n.default.httpClient.get("/admin/getGroups")},getRoleBases:function(){return n.default.httpClient.get("/admin/getRoleBases")},getPermissionTree:function(){return n.default.httpClient.get("/admin/getPermissionTree")},directlyCall:function(e){return n.default.httpClient.get(e)},download:function(e,t){return n.default.httpClient.post(e,t,{responseType:"arraybuffer"})}}},bzuE:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o}),i.d(t,"c",function(){return r});var n="/manager/api",o="",r=""},gRoo:function(e,t,i){"use strict";var n=i("nuCP"),o=i("ihtn"),r=function(e){i("TYWf")},a=i("VU/8")(n.a,o.a,!1,r,null,null);t.a=a.exports},ihtn:function(e,t,i){"use strict";var n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.isLoading,expression:"isLoading",modifiers:{fullscreen:!0,lock:!0}}]},[i("el-header",{staticClass:"header"},[i("el-breadcrumb",{staticClass:"breadcrumb",attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",[e._v("用户管理")]),e._v(" "),i("el-breadcrumb-item",[e._v("角色列表")])],1)],1),e._v(" "),i("el-main",{staticClass:"main"},[i("el-row",[i("el-col",[i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:e.handleAdd}},[e._v("添加")])],1)],1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,size:"mini","empty-text":e.emptyText}},[i("el-table-column",{attrs:{prop:"name",label:"名称"}}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:"42"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.row.isSystem,expression:"!scope.row.isSystem"}],class:{"ignore-elements":e.row.isSystem},attrs:{type:"text",size:"small",icon:"el-icon-rank"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:"42"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(i){e.handleEdit(t.row)}}})]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:"42"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSystem?e._e():i("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-delete"},on:{click:function(i){e.handleRemove(t.row)}}})]}}])})],1),e._v(" "),i("el-dialog",{attrs:{visible:e.mainFormDialogVisible,"close-on-click-modal":!1,width:"400px"},on:{"update:visible":function(t){e.mainFormDialogVisible=t}},nativeOn:{submit:function(e){e.preventDefault()}}},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n        "+e._s(e.editActive?"编辑":"添加")+"\n      ")]),e._v(" "),i("el-form",{ref:"mainForm",attrs:{model:e.mainForm,rules:e.mainFormRules,"label-position":"right","label-width":"80px",size:"mini"}},[i("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[i("el-input",{ref:"name",attrs:{"auto-complete":"off",placeholder:"请输入角色名称"},model:{value:e.mainForm.name,callback:function(t){e.$set(e.mainForm,"name","string"==typeof t?t.trim():t)},expression:"mainForm.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"包含权限"}},[i("el-tree",{ref:"editPermissionTree",attrs:{data:e.editPermissionTreeData,props:e.editPermissionTreeDefaultProps,"node-key":"id","empty-text":"","show-checkbox":"","default-expand-all":"","check-strictly":""},on:{"check-change":e.handlePermissionTreeCheckChange}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.handleMainFormSure(!1)}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleMainFormSure(!0)}}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"提示",visible:e.removeConfirmDialogVisible,width:"320px",center:""},on:{"update:visible":function(t){e.removeConfirmDialogVisible=t}}},[i("span",[e._v("删除该角色后，相关的数据也将被删除。"),i("br"),e._v("确定要删除吗？")]),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.handleRemoveSure(!1)}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleRemoveSure(!0)}}},[e._v("确 定")])],1)])],1)],1)},staticRenderFns:[]};t.a=n},nuCP:function(e,t,i){"use strict";var n=i("Lokx"),o=i.n(n),r=i("VsUZ");t.a={data:function(){return{isLoading:!1,list:null,removeActive:null,removeConfirmDialogVisible:!1,editActive:null,mainFormDialogVisible:!1,mainForm:{roleID:null,name:null,permissionIDs:null},mainFormRules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:50,message:"最多支持50个字符",trigger:"blur"}]},editPermissionTreeData:null,editPermissionTreeDefaultProps:{children:"children",label:"name"}}},mounted:function(){this.getList(),this.getPermissionTree()},computed:{emptyText:function(){return this.isLoading?"加载中...":"暂无数据"}},methods:{getList:function(){var e=this;this.isLoading=!0,r.a.getRoles().then(function(t){e.isLoading=!1,e.list=t.data.list,e.$nextTick(function(){e.setupSortable()})},function(t){e.isLoading=!1,e.showErrorMessage(t.message)})},getPermissionTree:function(){var e=this;r.a.getPermissionTree().then(function(t){e.editPermissionTreeData=t.data.tree},function(t){e.showErrorMessage(t.message)})},handleAdd:function(){var e=this;this.validateBaseData()&&(this.editActive=null,this.mainFormDialogVisible=!0,this.mainForm.roleID=null,this.mainForm.name=null,this.mainForm.permissionIDs=null,this.$nextTick(function(){e.$refs.editPermissionTree.setCheckedKeys([],!0),e.$refs.name.focus(),e.clearValidate("mainForm")}))},handleEdit:function(e){var t=this;this.validateBaseData()||this.showErrorMessage("基础数据缺失：权限列表"),this.editActive=e,this.mainFormDialogVisible=!0,this.mainForm.roleID=e.roleID,this.mainForm.name=e.name,this.mainForm.permissionIDs=e.permissions.map(function(e){return e.permissionID}),this.$nextTick(function(){t.$refs.editPermissionTree.setCheckedKeys(t.mainForm.permissionIDs,!0),t.clearValidate("mainForm")})},handleMainFormSure:function(e){e?this.editActive?this.edit():this.add():this.mainFormDialogVisible=!1},handleRemove:function(e){this.removeActive=e,this.removeConfirmDialogVisible=!0},handleRemoveSure:function(e){this.removeConfirmDialogVisible=!1,e?this.remove():this.removeActive=null},add:function(){var e=this;this.$refs.mainForm.validate(function(t){if(!t)return!1;e.isLoading=!0;var i={name:e.mainForm.name,permissionIDs:e.mainForm.permissionIDs};r.a.addRole(i).then(function(t){e.list.push(t.data.item),e.isLoading=!1,e.mainFormDialogVisible=!1},function(t){e.isLoading=!1,e.showErrorMessage(t.message)})})},edit:function(){var e=this;this.editActive?this.$refs.mainForm.validate(function(t){if(!t)return!1;e.isLoading=!0;var i={roleID:e.mainForm.roleID,name:e.mainForm.name,permissionIDs:e.mainForm.permissionIDs};r.a.editRole(i).then(function(t){e.list.splice(e.list.indexOf(e.editActive),1,t.data.item),e.isLoading=!1,e.editActive=null,e.mainFormDialogVisible=!1},function(t){e.isLoading=!1,e.showErrorMessage(t.message)})}):this.showErrorMessage("异常：无编辑目标")},remove:function(){var e=this;if(this.removeActive){var t={roleID:this.removeActive.roleID};this.isLoading=!0,r.a.removeRole(t).then(function(t){e.isLoading=!1;var i=e.list.indexOf(e.removeActive);e.list.splice(i,1),e.removeActive=null},function(t){e.isLoading=!1,e.showErrorMessage(t.message)})}},move:function(e,t){var i=this,n={sourceDisplayOrder:e,targetDisplayOrder:t};this.isLoading=!0,r.a.moveRole(n).then(function(e){i.isLoading=!1},function(e){i.isLoading=!1,i.showErrorMessage(e.message)})},validateBaseData:function(){return!!this.editPermissionTreeData||(this.showErrorMessage("基础数据缺失：权限列表"),!1)},handlePermissionTreeCheckChange:function(e,t,i){this.mainForm.permissionIDs=this.$refs.editPermissionTree.getCheckedKeys()},resetForm:function(e){this.$refs[e].resetFields()},clearValidate:function(e){this.$refs[e].clearValidate()},showErrorMessage:function(e){this.$message({message:e,type:"error"})},setupSortable:function(){var e=this,t=document.querySelectorAll(".el-table__body-wrapper > table > tbody")[0];this.sortable=o.a.create(t,{group:"name",handle:".el-icon-rank",filter:".ignore-elements",onMove:function(e,t){return 0!==e.dragged.rowIndex&&0!==e.related.rowIndex},onEnd:function(t){if(t.oldIndex!==t.newIndex){var i=t.oldIndex+1,n=t.newIndex+1;e.move(i,n)}}})}}}},tvR6:function(e,t){},uN2V:function(e,t){}},["UKyY"]);
//# sourceMappingURL=role.js.map